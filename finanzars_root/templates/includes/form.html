{% load form_tags widget_tweaks %}

{% if form.non_field_errors %}
<div class="alert alert-danger" role="alert">
  {% for error in form.non_field_errors %}
  <p{% if forloop.last %} class="mb-0" {% endif %}>{{ error }}</p>
    <!-- if it's the last non-field error we add mb-0 -->
    {% endfor %}
</div>
{% endif %}

{% for field in form %}
<div class="form-group">
  {{ field.label_tag }}
  <div class="input-group">
    {% render_field field class=field|input_class %}

    {% if field.name == 'cotiz_mep' %}
    <button type="button" id="obtener-mep-btn" class="btn btn-primary">Obtener MEP</button>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Obtener una referencia al botón "Obtener MEP"
      const obtenerMepBtn = document.getElementById("obtener-mep-btn");
  
      // Manejar el evento click del botón
      obtenerMepBtn.addEventListener("click", function () {
        // Realizar la solicitud para obtener el valor MEP desde el servidor
        fetch("{% url 'load_mep' %}")
          .then((response) => response.json())
          .then((data) => {
            // Obtener el valor de cotiz_mep_input y establecer el valor MEP obtenido
            const cotizMepInput = document.getElementById("id_cotiz_mep");
            cotizMepInput.value = data.toFixed(2); // Suponiendo que el valor MEP está en la propiedad 'mep' de la respuesta JSON
          })
          .catch((error) => {
            console.error("Error al obtener el valor MEP:", error);
          });
      });
    });
  </script>
  
  {% endif %}
  </div>

  {% if field.name == 'activo' %}
  <div id="nombreActivoDiv" class="ms-3 mt-2 mb-3"></div>
  {% endif %}

  {% for error in field.errors %}
  <div class="invalid-feedback">
    {{ error }}
  </div>
  {% endfor %}

  {% if field.help_text %}
  <small class="form-text text-muted">
    {{ field.help_text }}
  </small>
  {% endif %}
</div>
{% endfor %}